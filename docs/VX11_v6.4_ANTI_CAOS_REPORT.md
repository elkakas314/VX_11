# VX11 v6.4 Anti-Caos System

- **Archivos creados/modificados**
  - `hormiguero/auto_organizer.py`: auditor puro + emisor de INTENT organize (loop 3–5 min, log en `build/artifacts/logs/hormiguero_organizer.log`).
  - `hormiguero/main.py`: hook de startup/shutdown para el loop anti-caos y endpoint manual `/hormiguero/organizer/run`.
  - `manifestator/auto_patcher.py`: traduce INTENT → patch quirúrgico, prepara DEEPSEEK_API_KEY leyendo `tokens.env` sin exponerlo.
  - `madre/bridge_handler.py`: nueva HIJA organize que pide patch a Manifestator y aplica ops con spawner.
  - `madre/main.py`: endpoint `/madre/organize` para recibir INTENT organize.
  - `spawner/ephemeral_v2.py`: ejecutor seguro de operaciones (mv/rm/edit/mkdir) con backups y TTL.
  - Scripts: `scripts/auditor_orden_vx11.py`, `scripts/kill_zombies_vx11.sh`, `scripts/clean_fs_vx11.sh`, `scripts/run_anti_chaos_once.sh`.

- **Reglas de drift vigiladas (auditor)**
  - Entradas raíz no canónicas (`untracked_root_dir/file`, ocultos).
  - Docs fuera de `docs/archive`.
  - Logs/sandboxes/forensic fuera de `build/artifacts/{logs|sandbox|forensic_hashes}`.
  - Bases de datos fuera de `data/runtime`.
  - Desajustes de `package.json` vs `package-lock.json`.
  - `OPERATOR_MODE_AUDIT.py` sin referencia a `switch/hermes` o sin versión 6.4.

- **Ciclo automático**
  - Hormiguero (`auto_organizer`) escanea cada 300s (mín. 180s, configurable con `HORMIGUERO_ORGANIZER_INTERVAL`) y envía INTENT organize a Madre.
  - Madre (`/madre/organize`) crea HIJA organize, pide patch a Manifestator (`auto_patcher`), y aplica operaciones con `apply_patch_operations` de spawner (TTL 60s, backups en `build/artifacts/backups/<timestamp>`).
  - Manifestator genera operaciones no destructivas (mover a legacy/backups, editar import puntual de hermes si se detecta).

- **DeepSeek R1**
  - `manifestator/auto_patcher._ensure_deepseek_env` lee `tokens.env` para poblar `DEEPSEEK_API_KEY` si no está en entorno; no loguea el valor.
  - Uso opcional: disponible para razonamiento avanzado vía `config.deepseek` sin exponer tokens.

- **Protecciones / No tocar**
  - Nunca toca `data/runtime` ni `build/artifacts/backups` en eliminaciones (protegidos en executor).
  - No borra nada sin mover a backup cuando hay conflicto.
  - No crea módulos nuevos top-level; solo reutiliza hormiguero/manifestator/madre/spawner/scripts/docs.

- **Invocación manual**
  - Auditor puro: `python3 scripts/auditor_orden_vx11.py`.
  - Anti-caos one-shot: `bash scripts/run_anti_chaos_once.sh` (usa `python3 -m hormiguero.auto_organizer --emit --json`).
  - Limpieza zombies: `bash scripts/kill_zombies_vx11.sh` (confirmaciones interactivas).
  - Limpieza filesystem: `bash scripts/clean_fs_vx11.sh` (respeta backups y data/runtime).
