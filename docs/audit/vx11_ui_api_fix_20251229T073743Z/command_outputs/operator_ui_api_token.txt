sed -n '1,80p' operator_ui/frontend/src/services/api.ts
/**
 * API Client for VX11 Operator
 * Consumes: tentaculo_link:8000 only (via relative URL)
 * No direct calls to backend services
 * 
 * RELATIVE BASE_URL: Works across any host/IP/port
 * - Dev (Vite :5173): proxy /operator/api â†’ tentaculo_link:8000
 * - Prod: Operator UI mounted at /operator/ui in tentaculo_link
 */

const TOKEN =
    import.meta.env.VITE_VX11_TOKEN ||
    import.meta.env.VITE_VX11_TENTACULO_TOKEN ||
    'test-token-vx11' // In production: from auth service
const BASE_URL = import.meta.env.VITE_VX11_API_BASE_URL ?? '' // Empty = relative (same origin)

interface ApiResponse<T> {
    ok: boolean
    data?: T
    error?: string
    status: number
}

class ApiClient {
    private backoffMs = 1000
    private maxBackoffMs = 30000

    async request<T>(
        method: string,
        path: string,
        body?: any,
        options?: { noRetry?: boolean; timeout?: number }
    ): Promise<ApiResponse<T>> {
        const url = `${BASE_URL}${path}`
        const timeout = options?.timeout || 5000

        try {
            const controller = new AbortController()
            const timeoutId = setTimeout(() => controller.abort(), timeout)

            const response = await fetch(url, {
                method,
                headers: {
                    'Content-Type': 'application/json',
                    'x-vx11-token': TOKEN,
                },
                body: body ? JSON.stringify(body) : undefined,
                signal: controller.signal,
            })

            clearTimeout(timeoutId)

            if (!response.ok) {
                return {
                    ok: false,
                    error: `HTTP ${response.status}`,
                    status: response.status,
                }
            }

            const data = await response.json()
            return {
                ok: true,
                data,
                status: response.status,
            }
        } catch (err: any) {
            console.error(`API request failed: ${method} ${path}`, err)
            return {
                ok: false,
                error: err.message || 'Unknown error',
                status: 0,
            }
        }
    }

    // Chat endpoint (P0: via /operator/api/chat)
    async chat(message: string, sessionId?: string): Promise<ApiResponse<any>> {
        return this.request('POST', '/operator/api/chat', {
            message,
