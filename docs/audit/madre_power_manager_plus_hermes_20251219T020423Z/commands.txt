date -u +%Y%m%dT%H%M%SZ
mkdir -p docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/00_precheck
printf "" > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/commands.txt
echo docs/audit/madre_power_manager_plus_hermes_20251219T020423Z
pwd > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/00_precheck/pwd.txt
date -u > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/00_precheck/date_utc.txt
git status -sb > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/00_precheck/git_status_sb.txt
git log -1 > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/00_precheck/git_log_1.txt
python3 --version > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/00_precheck/python3_version.txt
uptime > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/00_precheck/uptime.txt
free -h > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/00_precheck/free_h.txt
ps aux --sort=-%cpu | head -n 100 > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/00_precheck/ps_top_cpu.txt
ps aux --sort=-%mem | head -n 100 > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/00_precheck/ps_top_mem.txt
ss -ltnp | rg ':(8000|8001|8002|8003|8004|8005|8006|8007|8008|8011|8020)\b' > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/00_precheck/ss_ports_8000_8020.txt
docker ps > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/00_precheck/docker_ps.txt
docker compose -f docker-compose.yml -f docker-compose.override.yml config --services > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/00_precheck/compose_services.txt
python3 - <<'PY' ... > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/00_precheck/00_truth_files.txt
python3 - <<'PY' ... > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/00_precheck/00_docker_perms.txt
cp docs/VX11_CONTEXT.md docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/00_precheck/canon_VX11_CONTEXT.md
cp docs/audit/DB_MAP_v7_FINAL.md docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/00_precheck/canon_DB_MAP_v7_FINAL.md
cp docs/audit/DB_SCHEMA_v7_FINAL.json docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/00_precheck/canon_DB_SCHEMA_v7_FINAL.json
cp docs/audit/DB_MAP_v7_META.txt docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/00_precheck/canon_DB_MAP_v7_META.txt
sqlite3 data/runtime/vx11.db -cmd "PRAGMA busy_timeout=5000;" "PRAGMA quick_check;" > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/01_quick_check.txt
sqlite3 data/runtime/vx11.db "SELECT module_name, status, port, health_url, checked_at_utc FROM module_status ORDER BY module_name;" > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/01_module_status_rows.txt
find . -type d -path './.github/.github' -o -path './.vscode/.vscode' -o -path './docs/audit/docs/audit' > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/01_forbidden_nesting_dirs.txt
rg --files -g 'SCORECARD_*.json' docs/audit > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/01_prev_scorecards.txt
rg --files -g 'SCORECARD_*.json' docs/audit || true > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/01_prev_scorecards.txt 2> docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/01_prev_scorecards.err.txt
python3 -m compileall . > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/01_compileall.txt 2>&1; echo 0 > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/01_compileall.rc
pytest -q -m "not integration" > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/01_pytest.txt 2>&1; echo 0 > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/01_pytest.rc
python3 - <<'PY' ... (baseline scoreboard)
python3 - <<'PY' ... (delta vs prev)
cat docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/01_compileall.rc
cat docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/01_pytest.rc
rg --files -g 'madre/**' > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madre_files.txt
rg -n 'power|db_retention|madre/power' madre > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madre_power_grep.txt
rg --files -g 'switch/**' > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_switch_files.txt
rg -n 'hermes' switch > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_switch_hermes_refs.txt
rg --files -g 'tentaculo_link/**' > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_tentaculo_files.txt
rg -n 'offline|service_offline|docker' tentaculo_link > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_tentaculo_offline_refs.txt
find . -type d -name 'hermes' > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_hermes_dirs.txt
rg -n 'hermes' docker-compose.yml docker-compose.override.yml > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_compose_hermes_refs.txt
rg --files -g 'madre/main.py' > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madre_main_path.txt
cat madre/main.py > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madre_main.py.txt
rg --files -g 'madre/**/*power*' > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madre_power_files.txt
while read -r f; do [ -n "" ] || continue; echo '### '$f >> docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madre_power_files_content.txt; cat "" >> docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madre_power_files_content.txt; echo '' >> docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madre_power_files_content.txt; done < docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madre_power_files.txt
python3 - <<'PY' ... (list hermes dirs and files)
rg -n 'FastAPI|Flask|app =|APIRouter|router|@app' -g '*.py' ./forensic/hermes ./docs/archive/hermes ./switch/hermes ./models/hermes > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_hermes_entrypoints.txt
python3 - <<'PY' ... (cat hermes entrypoint files)
rg -n 'FastAPI|APIRouter|@app|app =' switch > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_switch_entrypoints.txt
rg -n 'FastAPI|APIRouter|@app|app =' tentaculo_link > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_tentaculo_entrypoints.txt
python3 - <<'PY' ... (cat switch/tentaculo entrypoint files)
sed -n '1,200p' docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madre_main.py.txt
cat docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madre_power_grep.txt
sed -n '340,460p' madre/main.py > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madre_main_power_block.txt
sed -n '660,760p' madre/main_legacy.py > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madre_main_legacy_power_block.txt
sed -n '160,260p' madre/power_saver.py > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madre_power_saver_block.txt
sed -n '1,200p' docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_hermes_entrypoints_content.txt
rg -n 'madre' docker-compose.yml docker-compose.override.yml > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_compose_madre_refs.txt
cat docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_compose_madre_refs.txt
sed -n '35,80p' docker-compose.yml > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_compose_madre_block.txt
cat docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_compose_hermes_refs.txt
sed -n '100,130p' docker-compose.yml > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_compose_hermes_block.txt
sed -n '1,30p' docker-compose.override.yml > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_compose_override_head.txt
sed -n '1,200p' docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_hermes_dir_file_lists.txt
sed -n '1,200p' docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_switch_entrypoints_content.txt
rg --files -g 'switch/*main*.py' > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_switch_main_paths.txt
cat switch/main.py > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_switch_main.py.txt
sed -n '1,200p' docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_tentaculo_entrypoints_content.txt
echo 'sed failed: 02_tentaculo_entrypoints_content.txt missing; likely no FastAPI markers found' >> docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_errors.txt
rg --files -g 'tentaculo_link/*main*.py' > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_tentaculo_main_paths.txt
cat docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_tentaculo_main_paths.txt
cat tentaculo_link/main.py > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_tentaculo_main.py.txt
cat tentaculo_link/main_v7.py > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_tentaculo_main_v7.py.txt
sed -n '1,200p' docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_switch_main.py.txt
sed -n '1,200p' docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_tentaculo_main.py.txt
sed -n '1,200p' docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_tentaculo_main_v7.py.txt
rg -n 'FastAPI|health' tentaculo_link/main_v7.py > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_tentaculo_main_v7_fastapi.txt
wc -l tentaculo_link/main_v7.py > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_tentaculo_main_v7_wc.txt
tail -n 50 tentaculo_link/main_v7.py > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_tentaculo_main_v7_tail.txt
cat docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madre_main_power_block.txt
cat docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madre_main_legacy_power_block.txt
cat docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madre_power_saver_block.txt
cat madre/Dockerfile > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madre_dockerfile.txt
cat switch/hermes/Dockerfile > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_hermes_dockerfile.txt
sed -n '1,200p' docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madre_dockerfile.txt
sed -n '1,200p' docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_hermes_dockerfile.txt
rg -n 'docker' madre > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madre_docker_refs.txt
cat docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madre_docker_refs.txt
sed -n '1,140p' madre/power_saver.py > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madre_power_saver_head.txt
python3 - <<'PY' ... (list schema tables relevant to hermes/madre)
cat docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_schema_tables_relevant.txt
python3 - <<'PY' ... (write 02_audit_findings.md)
sed -n '1,200p' config/db_schema.py > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_db_schema_head.txt
sed -n '1,120p' docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_db_schema_head.txt
rg -n 'class MadreDB' -n madre -g '*.py' > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madredb_refs.txt
cat docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madredb_refs.txt
sed -n '1,200p' madre/core/db.py > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madredb_content.txt
sed -n '1,200p' docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madredb_content.txt
sed -n '1,120p' docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_madre_power_saver_head.txt
tail -n 80 switch/hermes/main.py > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_hermes_main_tail.txt
cat docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_hermes_main_tail.txt
rg -n '/hermes/discover' switch/hermes/main.py > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_hermes_discover_refs.txt
cat docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_hermes_discover_refs.txt
sed -n '700,820p' switch/hermes/main.py > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_hermes_discover_block.txt
cat docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_hermes_discover_block.txt
sed -n '1,200p' switch/hermes/local_scanner.py > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_hermes_local_scanner.txt
sed -n '1,80p' switch/hermes/main.py > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_hermes_main_head.txt
cat docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/02_hermes_main_head.txt
python3 - <<'PY' ... (write Phase3/4 notes)
git status -sb > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/03_git_status_sb.txt
git diff > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/03_git_diff.txt
PYTHONPATH=. python3 -m scripts.generate_db_map_from_db data/runtime/vx11.db > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/06_db_map_regen.txt 2>&1
cp docs/audit/DB_MAP_v7_FINAL.md docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/06_DB_MAP_v7_FINAL.md
cp docs/audit/DB_SCHEMA_v7_FINAL.json docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/06_DB_SCHEMA_v7_FINAL.json
cp docs/audit/DB_MAP_v7_META.txt docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/06_DB_MAP_v7_META.txt
python3 -m compileall . > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/07_compileall.txt 2>&1; echo 0 > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/07_compileall.rc
pytest -q -m "not integration" > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/07_pytest.txt 2>&1; echo 0 > docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/07_pytest.rc
python3 - <<'PY' ... (madre in-proc tests)
python3 - <<'PY' ... (madre in-proc tests retry)
cat docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/07_compileall.rc
cat docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/07_pytest.rc
python3 - <<'PY' ... (write 07_validation.md)
python3 - <<'PY' ... (scoreboard after)
python3 - <<'PY' ... (scoreboard after retry)
python3 - <<'PY' ... (scoreboard after optimized)
python3 - <<'PY' ... (scoreboard delta after)
cp docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/08_scoreboard_after.json docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/SCORECARD_20251219T020423Z.json
python3 - <<'PY' ... (FINAL_SUMMARY.md)
git add madre/power_manager.py madre/main.py switch/hermes/main.py hermes/__init__.py hermes/main.py tentaculo_link/clients.py operator_backend/backend/switch_integration.py operator_backend/frontend/src/api/operatorClient.js operator_backend/frontend/src/pages/Chat.jsx operator_backend/frontend/src/pages/Dashboard.jsx operator_backend/frontend/src/pages/Resources.jsx docs/audit/DB_MAP_v7_FINAL.md docs/audit/DB_SCHEMA_v7_FINAL.json docs/audit/DB_MAP_v7_META.txt docs/audit/madre_power_manager_plus_hermes_20251219T020423Z
echo 'git add failed: docs/audit/... ignored; re-adding with -f' >> docs/audit/madre_power_manager_plus_hermes_20251219T020423Z/command_errors.txt
