============================= test session starts ==============================
platform linux -- Python 3.10.12, pytest-7.4.3, pluggy-1.6.0
rootdir: /home/elkakas314/vx11
configfile: pytest.ini
testpaths: tests
plugins: cov-7.0.0, asyncio-0.21.1, anyio-3.7.1
asyncio: mode=auto
collected 110 items

tests/test_all_healthchecks.py s                                         [  0%]
tests/test_canonical_integrity.py ........                               [  8%]
tests/test_cli_concentrator_selection.py .....                           [ 12%]
tests/test_cli_usage_db_writes.py ....                                   [ 16%]
tests/test_context7_v7.py .........                                      [ 24%]
tests/test_fluzo_scoring_influence.py .....                              [ 29%]
tests/test_forensics_rotate.py .                                         [ 30%]
tests/test_ga_router_tokens.py .                                         [ 30%]
tests/test_health_endpoints.py s                                         [ 31%]
tests/test_hermes_cli_detection.py .                                     [ 32%]
tests/test_hermes_cli_registry_module.py .                               [ 33%]
tests/test_hermes_registry_db.py .                                       [ 34%]
tests/test_hormiguero_canonical.py ...                                   [ 37%]
tests/test_hormiguero_min.py ...                                         [ 40%]
tests/test_integration_flows_e2e.py ssss                                 [ 43%]
tests/test_leonidas_permissions.py ..                                    [ 45%]
tests/test_madre_orchestration.py ....                                   [ 49%]
tests/test_madre_power_manager_phase4.py ....                            [ 52%]
tests/test_operator_db_schema_v7.py .....                                [ 57%]
tests/test_operator_production_phase5.py FFF.F....F..                    [ 68%]
tests/test_pnp_and_switch_integration.py ......................          [ 88%]
tests/test_routingresult_compat.py .                                     [ 89%]
tests/test_shubniggurath_phase8.py ..                                    [ 90%]
tests/test_switch_auto.py s                                              [ 91%]
tests/test_switch_chat_and_breaker.py ss                                 [ 93%]
tests/test_switch_deepseek_staging.py s                                  [ 94%]
tests/test_switch_local.py s                                             [ 95%]
tests/test_switch_registry_enqueue.py .                                  [ 96%]
tests/test_tentaculo_link.py ....                                        [100%]

=================================== FAILURES ===================================
_____________________ test_vx11_overview_queries_tentaculo _____________________
tests/test_operator_production_phase5.py:75: in test_vx11_overview_queries_tentaculo
    response = client.get(
../.local/lib/python3.10/site-packages/starlette/testclient.py:499: in get
    return super().get(
../.local/lib/python3.10/site-packages/httpx/_client.py:1041: in get
    return self.request(
../.local/lib/python3.10/site-packages/starlette/testclient.py:465: in request
    return super().request(
../.local/lib/python3.10/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
../.local/lib/python3.10/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
../.local/lib/python3.10/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
../.local/lib/python3.10/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
../.local/lib/python3.10/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
../.local/lib/python3.10/site-packages/starlette/testclient.py:342: in handle_request
    raise exc
../.local/lib/python3.10/site-packages/starlette/testclient.py:339: in handle_request
    portal.call(self.app, scope, receive, send)
../.local/lib/python3.10/site-packages/anyio/from_thread.py:277: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/lib/python3.10/concurrent/futures/_base.py:458: in result
    return self.__get_result()
/usr/lib/python3.10/concurrent/futures/_base.py:403: in __get_result
    raise self._exception
../.local/lib/python3.10/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../.local/lib/python3.10/site-packages/fastapi/applications.py:1106: in __call__
    await super().__call__(scope, receive, send)
../.local/lib/python3.10/site-packages/starlette/applications.py:122: in __call__
    await self.middleware_stack(scope, receive, send)
../.local/lib/python3.10/site-packages/starlette/middleware/errors.py:184: in __call__
    raise exc
../.local/lib/python3.10/site-packages/starlette/middleware/errors.py:162: in __call__
    await self.app(scope, receive, _send)
../.local/lib/python3.10/site-packages/starlette/middleware/cors.py:83: in __call__
    await self.app(scope, receive, send)
../.local/lib/python3.10/site-packages/starlette/middleware/exceptions.py:79: in __call__
    raise exc
../.local/lib/python3.10/site-packages/starlette/middleware/exceptions.py:68: in __call__
    await self.app(scope, receive, sender)
../.local/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py:20: in __call__
    raise e
../.local/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py:17: in __call__
    await self.app(scope, receive, send)
../.local/lib/python3.10/site-packages/starlette/routing.py:718: in __call__
    await route.handle(scope, receive, send)
../.local/lib/python3.10/site-packages/starlette/routing.py:276: in handle
    await self.app(scope, receive, send)
../.local/lib/python3.10/site-packages/starlette/routing.py:66: in app
    response = await func(request)
../.local/lib/python3.10/site-packages/fastapi/routing.py:274: in app
    raw_response = await run_endpoint_function(
../.local/lib/python3.10/site-packages/fastapi/routing.py:191: in run_endpoint_function
    return await dependant.call(**values)
operator_backend/backend/main_v7.py:366: in vx11_overview
    healthy = sum(1 for v in modules.values() if v.get("status") == "ok")
operator_backend/backend/main_v7.py:366: in <genexpr>
    healthy = sum(1 for v in modules.values() if v.get("status") == "ok")
E   AttributeError: 'coroutine' object has no attribute 'get'
______________ test_vx11_overview_fallback_when_tentaculo_offline ______________
tests/test_operator_production_phase5.py:112: in test_vx11_overview_fallback_when_tentaculo_offline
    assert data["status"] in ["degraded", "partial"]
E   AssertionError: assert 'ok' in ['degraded', 'partial']
__________________ test_shub_dashboard_queries_shubniggurath ___________________
tests/test_operator_production_phase5.py:157: in test_shub_dashboard_queries_shubniggurath
    response = client.get(
../.local/lib/python3.10/site-packages/starlette/testclient.py:499: in get
    return super().get(
../.local/lib/python3.10/site-packages/httpx/_client.py:1041: in get
    return self.request(
../.local/lib/python3.10/site-packages/starlette/testclient.py:465: in request
    return super().request(
../.local/lib/python3.10/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
../.local/lib/python3.10/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
../.local/lib/python3.10/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
../.local/lib/python3.10/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
../.local/lib/python3.10/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
../.local/lib/python3.10/site-packages/starlette/testclient.py:342: in handle_request
    raise exc
../.local/lib/python3.10/site-packages/starlette/testclient.py:339: in handle_request
    portal.call(self.app, scope, receive, send)
../.local/lib/python3.10/site-packages/anyio/from_thread.py:277: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/lib/python3.10/concurrent/futures/_base.py:458: in result
    return self.__get_result()
/usr/lib/python3.10/concurrent/futures/_base.py:403: in __get_result
    raise self._exception
../.local/lib/python3.10/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../.local/lib/python3.10/site-packages/fastapi/applications.py:1106: in __call__
    await super().__call__(scope, receive, send)
../.local/lib/python3.10/site-packages/starlette/applications.py:122: in __call__
    await self.middleware_stack(scope, receive, send)
../.local/lib/python3.10/site-packages/starlette/middleware/errors.py:184: in __call__
    raise exc
../.local/lib/python3.10/site-packages/starlette/middleware/errors.py:162: in __call__
    await self.app(scope, receive, _send)
../.local/lib/python3.10/site-packages/starlette/middleware/cors.py:83: in __call__
    await self.app(scope, receive, send)
../.local/lib/python3.10/site-packages/starlette/middleware/exceptions.py:79: in __call__
    raise exc
../.local/lib/python3.10/site-packages/starlette/middleware/exceptions.py:68: in __call__
    await self.app(scope, receive, sender)
../.local/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py:20: in __call__
    raise e
../.local/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py:17: in __call__
    await self.app(scope, receive, send)
../.local/lib/python3.10/site-packages/starlette/routing.py:718: in __call__
    await route.handle(scope, receive, send)
../.local/lib/python3.10/site-packages/starlette/routing.py:276: in handle
    await self.app(scope, receive, send)
../.local/lib/python3.10/site-packages/starlette/routing.py:66: in app
    response = await func(request)
../.local/lib/python3.10/site-packages/fastapi/routing.py:274: in app
    raw_response = await run_endpoint_function(
../.local/lib/python3.10/site-packages/fastapi/routing.py:191: in run_endpoint_function
    return await dependant.call(**values)
operator_backend/backend/main_v7.py:407: in shub_dashboard
    "status": health.get("status", "offline"),
E   AttributeError: 'coroutine' object has no attribute 'get'
________________________ test_resources_queries_hermes _________________________
tests/test_operator_production_phase5.py:236: in test_resources_queries_hermes
    response = client.get(
../.local/lib/python3.10/site-packages/starlette/testclient.py:499: in get
    return super().get(
../.local/lib/python3.10/site-packages/httpx/_client.py:1041: in get
    return self.request(
../.local/lib/python3.10/site-packages/starlette/testclient.py:465: in request
    return super().request(
../.local/lib/python3.10/site-packages/httpx/_client.py:814: in request
    return self.send(request, auth=auth, follow_redirects=follow_redirects)
../.local/lib/python3.10/site-packages/httpx/_client.py:901: in send
    response = self._send_handling_auth(
../.local/lib/python3.10/site-packages/httpx/_client.py:929: in _send_handling_auth
    response = self._send_handling_redirects(
../.local/lib/python3.10/site-packages/httpx/_client.py:966: in _send_handling_redirects
    response = self._send_single_request(request)
../.local/lib/python3.10/site-packages/httpx/_client.py:1002: in _send_single_request
    response = transport.handle_request(request)
../.local/lib/python3.10/site-packages/starlette/testclient.py:342: in handle_request
    raise exc
../.local/lib/python3.10/site-packages/starlette/testclient.py:339: in handle_request
    portal.call(self.app, scope, receive, send)
../.local/lib/python3.10/site-packages/anyio/from_thread.py:277: in call
    return cast(T_Retval, self.start_task_soon(func, *args).result())
/usr/lib/python3.10/concurrent/futures/_base.py:458: in result
    return self.__get_result()
/usr/lib/python3.10/concurrent/futures/_base.py:403: in __get_result
    raise self._exception
../.local/lib/python3.10/site-packages/anyio/from_thread.py:217: in _call_func
    retval = await retval
../.local/lib/python3.10/site-packages/fastapi/applications.py:1106: in __call__
    await super().__call__(scope, receive, send)
../.local/lib/python3.10/site-packages/starlette/applications.py:122: in __call__
    await self.middleware_stack(scope, receive, send)
../.local/lib/python3.10/site-packages/starlette/middleware/errors.py:184: in __call__
    raise exc
../.local/lib/python3.10/site-packages/starlette/middleware/errors.py:162: in __call__
    await self.app(scope, receive, _send)
../.local/lib/python3.10/site-packages/starlette/middleware/cors.py:83: in __call__
    await self.app(scope, receive, send)
../.local/lib/python3.10/site-packages/starlette/middleware/exceptions.py:79: in __call__
    raise exc
../.local/lib/python3.10/site-packages/starlette/middleware/exceptions.py:68: in __call__
    await self.app(scope, receive, sender)
../.local/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py:20: in __call__
    raise e
../.local/lib/python3.10/site-packages/fastapi/middleware/asyncexitstack.py:17: in __call__
    await self.app(scope, receive, send)
../.local/lib/python3.10/site-packages/starlette/routing.py:718: in __call__
    await route.handle(scope, receive, send)
../.local/lib/python3.10/site-packages/starlette/routing.py:276: in handle
    await self.app(scope, receive, send)
../.local/lib/python3.10/site-packages/starlette/routing.py:66: in app
    response = await func(request)
../.local/lib/python3.10/site-packages/fastapi/routing.py:274: in app
    raw_response = await run_endpoint_function(
../.local/lib/python3.10/site-packages/fastapi/routing.py:191: in run_endpoint_function
    return await dependant.call(**values)
operator_backend/backend/main_v7.py:439: in resources
    "status": health.get("status", "offline"),
E   AttributeError: 'coroutine' object has no attribute 'get'
______________________ test_fallback_when_service_offline ______________________
tests/test_operator_production_phase5.py:400: in test_fallback_when_service_offline
    assert data["status"] in ["degraded", "partial"]
E   AssertionError: assert 'ok' in ['degraded', 'partial']
=========================== short test summary info ============================
SKIPPED [1] tests/test_all_healthchecks.py: Integration tests skipped by default. Set VX11_INTEGRATION=1 to run.
SKIPPED [1] tests/test_health_endpoints.py: Integration tests skipped by default. Set VX11_INTEGRATION=1 to run.
SKIPPED [1] tests/test_integration_flows_e2e.py:56: Set VX11_INTEGRATION=1 to run integration tests
SKIPPED [1] tests/test_integration_flows_e2e.py:95: Set VX11_INTEGRATION=1 to run integration tests
SKIPPED [1] tests/test_integration_flows_e2e.py:144: Set VX11_INTEGRATION=1 to run integration tests
SKIPPED [1] tests/test_integration_flows_e2e.py:168: Set VX11_INTEGRATION=1 to run integration tests
SKIPPED [1] tests/test_switch_auto.py: Integration tests skipped by default. Set VX11_INTEGRATION=1 to run.
SKIPPED [2] tests/test_switch_chat_and_breaker.py: Integration tests skipped by default. Set VX11_INTEGRATION=1 to run.
SKIPPED [1] tests/test_switch_deepseek_staging.py: Integration tests skipped by default. Set VX11_INTEGRATION=1 to run.
SKIPPED [1] tests/test_switch_local.py: Integration tests skipped by default. Set VX11_INTEGRATION=1 to run.
FAILED tests/test_operator_production_phase5.py::test_vx11_overview_queries_tentaculo
FAILED tests/test_operator_production_phase5.py::test_vx11_overview_fallback_when_tentaculo_offline
FAILED tests/test_operator_production_phase5.py::test_shub_dashboard_queries_shubniggurath
FAILED tests/test_operator_production_phase5.py::test_resources_queries_hermes
FAILED tests/test_operator_production_phase5.py::test_fallback_when_service_offline
============ 5 failed, 94 passed, 11 skipped, 13 warnings in 7.91s =============
sys:1: RuntimeWarning: coroutine 'AsyncMockMixin._execute_mock_call' was never awaited
RuntimeWarning: Enable tracemalloc to get the object allocation traceback
