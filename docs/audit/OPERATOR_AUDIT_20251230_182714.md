# Operator Audit 20251230_182714

## Scope
- Operator frontend/backend, tentaculo_link, switch

## Evidence Log
\n### Structure
\n#### operator
operator
operator/frontend
operator/frontend/src
operator/frontend/src/__tests__
operator/frontend/src/services
operator/frontend/src/components
operator/frontend/src/stores
operator/frontend/src/views
operator/frontend/__tests__
operator/frontend/node_modules
operator/frontend/node_modules/esbuild
operator/frontend/node_modules/@csstools
operator/frontend/node_modules/tinypool
operator/frontend/node_modules/saxes
operator/frontend/node_modules/yallist
operator/frontend/node_modules/dequal
operator/frontend/node_modules/is-number
operator/frontend/node_modules/debug
operator/frontend/node_modules/https-proxy-agent
operator/frontend/node_modules/merge2
operator/frontend/node_modules/lru-cache
operator/frontend/node_modules/mdn-data
operator/frontend/node_modules/whatwg-mimetype
operator/frontend/node_modules/ws
operator/frontend/node_modules/stackback
operator/frontend/node_modules/browserslist
operator/frontend/node_modules/totalist
operator/frontend/node_modules/ufo
operator/frontend/node_modules/is-glob
operator/frontend/node_modules/cssstyle
operator/frontend/node_modules/scheduler
operator/frontend/node_modules/fill-range
operator/frontend/node_modules/fast-glob
operator/frontend/node_modules/@vitest
operator/frontend/node_modules/why-is-node-running
operator/frontend/node_modules/aria-query
operator/frontend/node_modules/strip-literal
operator/frontend/node_modules/whatwg-url
operator/frontend/node_modules/csstype
operator/frontend/node_modules/acorn
operator/frontend/node_modules/yocto-queue
operator/frontend/node_modules/caniuse-lite
operator/frontend/node_modules/mlly
operator/frontend/node_modules/ms
operator/frontend/node_modules/json5
operator/frontend/node_modules/react-is
operator/frontend/node_modules/pretty-format
operator/frontend/node_modules/nanoid
operator/frontend/node_modules/picocolors
operator/frontend/node_modules/get-func-name
operator/frontend/node_modules/symbol-tree
operator/frontend/node_modules/is-extglob
operator/frontend/node_modules/xml-name-validator
operator/frontend/node_modules/gensync
operator/frontend/node_modules/pathval
operator/frontend/node_modules/to-regex-range
operator/frontend/node_modules/agent-base
operator/frontend/node_modules/tldts-core
operator/frontend/node_modules/chai
operator/frontend/node_modules/ansi-regex
operator/frontend/node_modules/type-detect
operator/frontend/node_modules/http-proxy-agent
operator/frontend/node_modules/xmlchars
operator/frontend/node_modules/@polka
operator/frontend/node_modules/.bin
operator/frontend/node_modules/w3c-xmlserializer
operator/frontend/node_modules/tinyspy
operator/frontend/node_modules/vite
operator/frontend/node_modules/css-tree
operator/frontend/node_modules/micromatch
operator/frontend/node_modules/diff-sequences
operator/frontend/node_modules/fastq
operator/frontend/node_modules/vite-node
operator/frontend/node_modules/@exodus
operator/frontend/node_modules/pathe
operator/frontend/node_modules/tldts
operator/frontend/node_modules/decimal.js
operator/frontend/node_modules/magic-string
operator/frontend/node_modules/@babel
operator/frontend/node_modules/fflate
operator/frontend/node_modules/@jridgewell
operator/frontend/node_modules/punycode
operator/frontend/node_modules/react
operator/frontend/node_modules/js-tokens
operator/frontend/node_modules/cac
operator/frontend/node_modules/require-from-string
operator/frontend/node_modules/use-sync-external-store
operator/frontend/node_modules/tough-cookie
operator/frontend/node_modules/jsesc
operator/frontend/node_modules/vitest
operator/frontend/node_modules/loose-envify
operator/frontend/node_modules/ansi-styles
operator/frontend/node_modules/jsdom
operator/frontend/node_modules/@esbuild
operator/frontend/node_modules/zustand
operator/frontend/node_modules/tr46
operator/frontend/node_modules/undici-types
operator/frontend/node_modules/@types
operator/frontend/node_modules/typescript
operator/frontend/node_modules/@nodelib
operator/frontend/node_modules/lz-string
operator/frontend/node_modules/dom-accessibility-api
operator/frontend/node_modules/baseline-browser-mapping
operator/frontend/node_modules/update-browserslist-db
operator/frontend/node_modules/confbox
operator/frontend/node_modules/node-releases
operator/frontend/node_modules/pkg-types
operator/frontend/node_modules/mrmime
operator/frontend/node_modules/picomatch
operator/frontend/node_modules/p-limit
operator/frontend/node_modules/sirv
operator/frontend/node_modules/tinybench
operator/frontend/node_modules/@sinclair
operator/frontend/node_modules/parse5
operator/frontend/node_modules/convert-source-map
operator/frontend/node_modules/escalade
operator/frontend/node_modules/siginfo
operator/frontend/node_modules/electron-to-chromium
operator/frontend/node_modules/bidi-js
operator/frontend/node_modules/react-refresh
operator/frontend/node_modules/html-encoding-sniffer
operator/frontend/node_modules/entities
operator/frontend/node_modules/check-error
operator/frontend/node_modules/@asamuzakjp
operator/frontend/node_modules/glob-parent
operator/frontend/node_modules/data-urls
operator/frontend/node_modules/source-map-js
operator/frontend/node_modules/braces
operator/frontend/node_modules/@jest
operator/frontend/node_modules/loupe
operator/frontend/node_modules/run-parallel
operator/frontend/node_modules/local-pkg
operator/frontend/node_modules/is-potential-custom-element-name
operator/frontend/node_modules/@testing-library
operator/frontend/node_modules/deep-eql
operator/frontend/node_modules/acorn-walk
operator/frontend/node_modules/react-dom
operator/frontend/node_modules/semver
operator/frontend/node_modules/@vitejs
operator/frontend/node_modules/postcss
operator/frontend/node_modules/queue-microtask
operator/frontend/node_modules/flatted
operator/frontend/node_modules/reusify
operator/frontend/node_modules/@rollup
operator/frontend/node_modules/@acemir
operator/frontend/node_modules/std-env
operator/frontend/node_modules/assertion-error
operator/frontend/node_modules/rollup
operator/frontend/node_modules/webidl-conversions
operator/frontend/node_modules/@rolldown
operator/backend
\n#### tentaculo_link
tentaculo_link
tentaculo_link/tools
tentaculo_link/api
tentaculo_link/systemd
tentaculo_link/_legacy
tentaculo_link/_legacy/notes
tentaculo_link/_legacy/inbox
tentaculo_link/adapters
tentaculo_link/core
tentaculo_link/tests
tentaculo_link/config
tentaculo_link/db
tentaculo_link/routes
\n#### switch
switch
switch/fluzo
switch/workers
switch/providers
switch/providers/__pycache__
switch/hermes
switch/cli_concentrator
switch/cli_concentrator/providers

### Endpoints + Routing (current)
- tentaculo_link/main_v7.py
  - /operator/api/* is proxied to operator_backend /api/v1/* via operator_api_proxy middleware.
  - /operator/chat + /operator/chat/ask route to switch via tentaculo_link (single entrypoint).
  - /operator/ui mounts static dist from /app/operator/frontend/dist (if exists).
- operator/backend/main.py
  - /operator/api/* exposes health/status/modules/audit/events/chat/settings and proxies to tentaculo_link.
  - /api and /api/v1 aliases map to /operator/api/*.
  - /operator/api/chat forwards to tentaculo_link /operator/chat/ask.
\n### Dockerfiles (current)
- operator/backend/Dockerfile exists
- operator/frontend/Dockerfile missing
============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-7.4.3, pluggy-1.6.0
rootdir: /workspace/VX_11
configfile: pytest.ini
plugins: asyncio-0.21.1, anyio-3.7.1, cov-4.1.0
asyncio: mode=Mode.AUTO
collected 8 items

tests/test_operator_chat_e2e_p1.py FFFFFFFF                              [100%]

=================================== FAILURES ===================================
_____________ TestOperatorChatE2E.test_01_operator_backend_health ______________
tests/test_operator_chat_e2e_p1.py:36: in test_01_operator_backend_health
    resp = client.get(f"{self.BASE_OPERATOR}/health", headers=self.HEADERS)
E   AttributeError: 'TestOperatorChatE2E' object has no attribute 'HEADERS'. Did you mean: 'HEADERS_1'?
_______________ TestOperatorChatE2E.test_02_operator_api_status ________________
tests/test_operator_chat_e2e_p1.py:45: in test_02_operator_api_status
    resp = client.get(f"{self.BASE_OPERATOR}/api/status", headers=self.HEADERS)
E   AttributeError: 'TestOperatorChatE2E' object has no attribute 'HEADERS'. Did you mean: 'HEADERS_1'?
__________ TestOperatorChatE2E.test_03_tentaculo_operator_chat_exists __________
tests/test_operator_chat_e2e_p1.py:64: in test_03_tentaculo_operator_chat_exists
    headers=self.HEADERS,
E   AttributeError: 'TestOperatorChatE2E' object has no attribute 'HEADERS'. Did you mean: 'HEADERS_1'?
____________ TestOperatorChatE2E.test_04_operator_api_chat_endpoint ____________
tests/test_operator_chat_e2e_p1.py:87: in test_04_operator_api_chat_endpoint
    headers=self.HEADERS,
E   AttributeError: 'TestOperatorChatE2E' object has no attribute 'HEADERS'. Did you mean: 'HEADERS_1'?
_______________ TestOperatorChatE2E.test_05_madre_chat_endpoint ________________
tests/test_operator_chat_e2e_p1.py:105: in test_05_madre_chat_endpoint
    headers=self.HEADERS,
E   AttributeError: 'TestOperatorChatE2E' object has no attribute 'HEADERS'. Did you mean: 'HEADERS_1'?
________________ TestOperatorChatE2E.test_06_payload_validation ________________
tests/test_operator_chat_e2e_p1.py:121: in test_06_payload_validation
    headers=self.HEADERS,
E   AttributeError: 'TestOperatorChatE2E' object has no attribute 'HEADERS'. Did you mean: 'HEADERS_1'?
_______________ TestOperatorChatE2E.test_07_session_correlation ________________
tests/test_operator_chat_e2e_p1.py:141: in test_07_session_correlation
    headers=self.HEADERS,
E   AttributeError: 'TestOperatorChatE2E' object has no attribute 'HEADERS'. Did you mean: 'HEADERS_1'?
___________ TestOperatorChatE2E.test_08_tentaculo_fallback_detection ___________
tests/test_operator_chat_e2e_p1.py:160: in test_08_tentaculo_fallback_detection
    headers=self.HEADERS,
E   AttributeError: 'TestOperatorChatE2E' object has no attribute 'HEADERS'. Did you mean: 'HEADERS_1'?
=========================== short test summary info ============================
FAILED tests/test_operator_chat_e2e_p1.py::TestOperatorChatE2E::test_01_operator_backend_health
FAILED tests/test_operator_chat_e2e_p1.py::TestOperatorChatE2E::test_02_operator_api_status
FAILED tests/test_operator_chat_e2e_p1.py::TestOperatorChatE2E::test_03_tentaculo_operator_chat_exists
FAILED tests/test_operator_chat_e2e_p1.py::TestOperatorChatE2E::test_04_operator_api_chat_endpoint
FAILED tests/test_operator_chat_e2e_p1.py::TestOperatorChatE2E::test_05_madre_chat_endpoint
FAILED tests/test_operator_chat_e2e_p1.py::TestOperatorChatE2E::test_06_payload_validation
FAILED tests/test_operator_chat_e2e_p1.py::TestOperatorChatE2E::test_07_session_correlation
FAILED tests/test_operator_chat_e2e_p1.py::TestOperatorChatE2E::test_08_tentaculo_fallback_detection
============================== 8 failed in 0.29s ===============================

### Phase Updates (in-progress)
- docker-compose.full-test.yml updated: removed version, removed host ports for redis/madre/switch/operator-backend, added operator-ui-dist volume and mount into tentaculo_link.
- operator/frontend/Dockerfile added for static build export to shared volume.
- operator/backend settings endpoint now read-only unless window_active.
- operator frontend updated for Modules/Hormiguero tabs, API base via VITE_API_BASE, dark UI tweaks.
============================= test session starts ==============================
platform linux -- Python 3.12.12, pytest-7.4.3, pluggy-1.6.0
rootdir: /workspace/VX_11
configfile: pytest.ini
plugins: asyncio-0.21.1, anyio-3.7.1, cov-4.1.0
asyncio: mode=Mode.AUTO
collected 13 items

tests/test_operator_phase1_3.py .....                                    [ 38%]
tests/test_operator_auth_policy_p0.py ....                               [ 69%]
tests/test_no_bypass.py ..                                               [ 84%]
tests/test_operator_no_bypass.py ..                                      [100%]

============================== 13 passed in 1.07s ==============================
bash: command not found: docker
bash: command not found: docker

### Frontend Dev Server (screenshot)
- Ran `npm run dev -- --host 0.0.0.0 --port 5173` (vite). Proxy errors to http://127.0.0.1:8000 when backend not running (ECONNREFUSED).
