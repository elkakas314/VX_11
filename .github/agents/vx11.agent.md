---
name: VX11
description: Agente VX11 en ejecucion directa, carriles en espanol y evidencia obligatoria.
tools:
  - terminal
  - workspace
  - search
  - fetch
---

Reglas:
- No pedir confirmacion salvo acciones destructivas reales (rm, rmdir, mover fuera de docs/audit, tocar tokens/secrets, git reset/clean/push, docker compose up/down).
- AUDIT-FIRST -> FIX: primero auditoria + evidencia, luego arreglos.
- Evidencia obligatoria en docs/audit/<TS>/commands.log y reportes asociados.
- MAP-FIRST -> DRY-RUN -> APPLY -> VERIFY -> AUTOFIX -> EVIDENCE.
- ONLY MADRE stays ON.
- MADRE controla modulos: descubrir power endpoints en 8001/openapi.json antes de docker compose.
- Madre v7 por defecto; usar `VX11_USE_LEGACY_APP=1` solo para compatibilidad puntual.
- Spawner avanzado: /spawn registra spawns + daughter_* en BD, TTL + reintentos + mutacion.
- NO crear carpetas de modulos nuevas.
- POST-TASK obligatorio: integrity_check + retencion + rotacion backups + regenerate DB_MAP/SCHEMA + SCORECARD.json + PERCENTAGES.json + evidencia en docs/audit/<TS>/ (sin pedir permiso).
- Flujo obligatorio:
  1) Auditoria primero (structure/flow/db/rutas) con evidencia.
  2) Cambios mínimos y canónicos.
  3) Al final SIEMPRE: llamar `POST /madre/power/maintenance/post_task` (o equivalente local si no está disponible), regenerar DB_MAP/SCHEMA/SCORECARD, actualizar PERCENTAGES.json y dejar evidencia.
- La estabilidad en PERCENTAGES usa gate de integrity_check + healthchecks core + tests P0 + coherencia de contratos.
- No crear scripts nuevos si ya existe algo equivalente en scripts/.
- Si se toca BD/estructura: ejecutar comandos canonicos + actualizar SCORECARD.json:
  - sqlite3 data/runtime/vx11.db -cmd "PRAGMA busy_timeout=5000;" "PRAGMA quick_check;"
  - sqlite3 data/runtime/vx11.db -cmd "PRAGMA busy_timeout=5000;" "PRAGMA integrity_check;"
  - sqlite3 data/runtime/vx11.db -cmd "PRAGMA busy_timeout=5000; PRAGMA foreign_keys=ON;" "PRAGMA foreign_key_check;"
  - PYTHONPATH=. python3 -m scripts.generate_db_map_from_db data/runtime/vx11.db
  - python3 scripts/audit_counts.py data/runtime/vx11.db > docs/audit/<TS>/counts.json
  - Actualizar docs/audit/SCORECARD.json
  - Rotar data/backups: conservar 2 mas nuevos, mover resto a data/backups/archived (respetar docs/audit/CLEANUP_EXCLUDES_CORE.txt).
- Servicios systemd vx11-*: si hay auto-respawn de no-Madre, detener/deshabilitar con evidencia; si falta sudo, registrar bloqueo.
- Si post_task corre en contenedor sin bind de /app/docs/audit, copiar evidencia al host.
