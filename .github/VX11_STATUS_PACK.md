# VX11 STATUS PACK ‚Äî Fuente √önica de Verdad

**Versi√≥n**: 1.0  
**√öltima actualizaci√≥n**: 2025-12-30T22:00:00Z  
**Prop√≥sito**: Ancla √∫nica para `@vx11 status` + contexto bootstrap de todo agente.

---

## üìã INVARIANTES CORE (NON-NEGOTIABLE)

### Single-Entrypoint Principle
- **URL √∫nica externa**: `http://localhost:8000` (tentaculo_link)
- **Todos los clientes** ‚Üí tentaculo_link (`/operator/api/*`, `/api/*`)
- **Nunca** exponer madre, spawner, switch internos directamente
- **Tokens**: vx11-local-token (test), VX11_TENTACULO_LINK_TOKEN (prod)

### SOLO_MADRE Policy (Default)
- **Modo operacional**: `SOLO_MADRE=1` (default) ‚Üí solo madre + redis
- **Windowed mode**: Temporal, TTL-gated, expl√≠citamente abierto por Madre
- **Operator access**: Observer mode ONLY (OPERATOR_CONTROL_ENABLED=0 en test)
- **Spawner**: Safe commands (`echo 'vx11 spawner ok'`), TTL=1s forzado

### Roles & Tokens
| Role | Token Header | Scope | Default |
|------|--------------|-------|---------|
| Operator | X-VX11-Token | Observer (read-only) | test-token-vx11 |
| Internal | X-VX11-Token | Full (madre, spawner) | vx11-local-token |
| Test | X-VX11-Token | Full test profile | vx11-test-token |

---

## üó∫Ô∏è M√ìDULOS & PUERTOS

| M√≥dulo | Puerto | Profile | Role | Health |
|--------|--------|---------|------|--------|
| **madre** | 8001 | full-test | Controller | ‚úì heartbeat /health |
| **tentaculo_link** | 8000 | full-test | Gateway | ‚úì GET /health |
| **switch** | 8002 | full-test | LLM router | ‚ö† check logs |
| **operator-backend** | 8003 | full-test | API bridge | ‚úì GET /health |
| **operator-frontend** | 8004 | full-test | Web UI | ‚úì GET /operator/ui/ |
| **spawner** | 8005 | full-test | Task runner | ‚úì GET /health |
| **redis** | 6379 | full-test | Cache | ‚úì healthcheck |
| **redis-test** | 6379 | full-test | Test cache | ‚úì healthcheck |

---

## üîë RUTAS CLAVE & ARCHIVOS

### Contexto Obligatorio (Leer primero)
1. **docs/audit/CLEANUP_EXCLUDES_CORE.txt** ‚Äî Hard-exclude paths (no borrar)
2. **docs/audit/DB_SCHEMA_v7_FINAL.json** ‚Äî Current DB structure (86 tables)
3. **docs/audit/DB_MAP_v7_FINAL.md** ‚Äî Table mapping + metadata
4. **docs/canon/CANONICAL_SHUB_VX11.json** ‚Äî Active specs
5. **docs/audit/SCORECARD.json** ‚Äî Stability metrics + percentages
6. **docs/audit/DB_MAP_v7_META.txt** ‚Äî Meta info (timestamps, row counts)
7. **.github/agents/vx11.agent.md** ‚Äî Agent protocol (THIS file references it)
8. **.github/copilot-instructions.md** ‚Äî Copilot rules (updated below)

### Audit & Forensic
- **docs/audit/$TS/** ‚Äî Timestamped evidence directories
- **forensic/crashes/** ‚Äî NEVER deleted, only ARCHIVED to docs/audit/archived_forensic/
- **data/backups/** ‚Äî Keep 2 newest, rotate rest to data/backups/archived/

### Database
- **data/runtime/vx11.db** ‚Äî SQLite (591 MB, integrity_check=ok)
- **Canonical commands**:
  ```bash
  sqlite3 data/runtime/vx11.db "PRAGMA quick_check;"
  sqlite3 data/runtime/vx11.db "PRAGMA integrity_check;"
  sqlite3 data/runtime/vx11.db "PRAGMA foreign_keys=ON; PRAGMA foreign_key_check;"
  ```

---

## üîÑ POST-TASK CHECKLIST (AUTO-RUN AFTER CADA CAMBIO)

**Ejecutar SIEMPRE tras cambios significativos:**

```bash
# 1. DB validation
sqlite3 data/runtime/vx11.db "PRAGMA quick_check; PRAGMA integrity_check; PRAGMA foreign_key_check;"

# 2. Regenerate maps
PYTHONPATH=. python3 -m scripts.generate_db_map_from_db data/runtime/vx11.db

# 3. Audit counts
python3 scripts/audit_counts.py data/runtime/vx11.db > docs/audit/$TS/counts.json

# 4. SCORECARD regeneration
# (auto-generated by madre /power/maintenance/post_task or manual update)

# 5. Commit atomic
git add -A && git commit -m "vx11: <task> + post-task DB regeneration"

# 6. Push
git push vx_11_remote main
git push origin main
```

---

## ü§ñ DeepSeek R1 DEFAULT RULE

### Cuando usar DeepSeek R1
- **Razonamiento complejo**: debugging, analysis, tracing
- **Escritura de c√≥digo**: implementaci√≥n, refactoring
- **Decisiones arquitect√≥nicas**: PRs, integrations

### C√≥mo usarlo
1. **Si disponible en VX11**: Usar endpoint `/operator/api/assist/deepseek_r1`
2. **CLI**: Pasar `--model deepseek-r1` a cualquier LLM call
3. **Fallback**: Si no disponible ‚Üí GPT-5 mini / GPT-4.1 (registrar en log)

### Registro obligatorio
- Metadata de response: `{ provider_used, model_used, trace_id }`
- Log en `docs/audit/$TS/model_usage.json`
- Si degradation: marcar en SCORECARD.json

---

## üìä STATUS OUTPUT FORMAT (Fijo)

Cuando `@vx11 status` se ejecuta, DEBE retornar:

```
## **@vx11 STATUS REPORT** ‚Äî [TS]

### **GIT**
- Branch: main
- HEAD: [commit_hash] (message)
- Remote: vx_11_remote (https://...) + origin
- Working tree: [clean|modified] (# files)

### **DOCKER** (docker-compose.full-test.yml)
| Service | Status | Health |
|---------|--------|--------|
| madre | Up XXm | ‚úì/‚ö†/‚úó |
| operador-* | Up XXm | ‚úì/‚ö†/‚úó |
| tentaculo_link | Up XXm | ‚úì/‚ö†/‚úó |
| switch | Up XXm | ‚úì/‚ö†/‚úó |
| redis | Up XXm | ‚úì/‚ö†/‚úó |

### **DATABASE**
- File: data/runtime/vx11.db (XXX MB)
- quick_check: ok ‚úì
- integrity_check: ok ‚úì
- foreign_key_check: (no violations) ‚úì
- Tables: 86 | Rows: 1,149,855

### **MAPAS & AUDITOR√çA**
| File | Status | Timestamp |
|------|--------|-----------|
| DB_MAP_v7_FINAL.md | ‚úì | [TS] |
| DB_SCHEMA_v7_FINAL.json | ‚úì | [TS] |
| SCORECARD.json | ‚úì | [TS] |

### **PERCENTAGES** (if SCORECARD.json present)
- Orden_fs_pct: XX%
- Coherencia_routing_pct: XX%
- Automatizacion_pct: XX%
- Autonomia_pct: XX%
- Global_ponderado_pct: XX%

### **BLOCKERS** (if any)
- BLOCKED: [resource] not found at [path]
```

---

## üõ°Ô∏è CLEANUP & ARCHIVE RULES

### Hard-Excludes (NEVER TOUCH)
- Load `docs/audit/CLEANUP_EXCLUDES_CORE.txt`
- If path is CORE ‚Üí ABORT + report in `docs/audit/`
- **Examples**: madre/, config/, .env, tokens.env

### Safe-to-Archive
- `forensic/` crash files ‚Üí `docs/audit/archived_forensic/`
- Old backups (keep 2 newest) ‚Üí `data/backups/archived/`
- Legacy agent files ‚Üí `docs/audit/archived_agents/`

### Never-Delete
- **forensic/crashes/** (archive only)
- **docs/canon/** (canonical specs)
- **.github/** (agent/instructions/workflows)
- **data/runtime/vx11.db** (backup first)

---

## üöÄ QUICK COMMANDS

```bash
# Status check
@vx11 status

# Health check all services
curl -s http://localhost:8000/health
curl -s http://localhost:8001/health

# Operator UI
open http://localhost:8000/operator/ui/

# Chat endpoint
curl -X POST http://localhost:8000/operator/api/chat \
  -H "X-VX11-Token: vx11-local-token" \
  -H "Content-Type: application/json" \
  -d '{"message":"ping","session_id":"test"}'

# Deploy maintenance
POST http://localhost:8001/madre/power/maintenance/post_task

# Apply SOLO_MADRE policy
curl -X POST http://localhost:8001/madre/power/policy/solo_madre/apply
```

---

## üìù VERSIONING

| Version | Date | Changes |
|---------|------|---------|
| 1.0 | 2025-12-30 | Initial STATUS_PACK created; DeepSeek R1 default rule; POST-TASK checklist |

---

**üîê Golden Rule**: No cambios sin evidencia. Siempre audit. Siempre push a vx_11_remote + origin.
