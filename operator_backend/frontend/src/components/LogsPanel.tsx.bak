import * as React from "react";

type Props = { events: any[] };

export function LogsPanel({ events = [] }: Props) {
    const [moduleFilter, setModuleFilter] = React.useState<string>("all");
    const [levelFilter, setLevelFilter] = React.useState<string>("all");

    const filtered = events
        .filter((ev) => (moduleFilter === "all" ? true : (ev.module || ev.data?.module) === moduleFilter))
        .filter((ev) => (levelFilter === "all" ? true : (ev.level || "INFO").toUpperCase() === levelFilter))
        .slice(0, 200);

    return (
        <div className="card">
            <h3>Logs en vivo</h3>
            <div style={{ display: "flex", gap: "8px", marginBottom: "6px", fontSize: "11px" }}>
                <select value={moduleFilter} onChange={(e) => setModuleFilter(e.target.value)}>
                    <option value="all">Todos</option>
                    <option value="switch">switch</option>
                    <option value="hermes">hermes</option>
                    <option value="madre">madre</option>
                    <option value="hormiguero">hormiguero</option>
                    <option value="browser">browser</option>
                    <option value="shub">shub</option>
                    <option value="operator">operator</option>
                </select>
                <select value={levelFilter} onChange={(e) => setLevelFilter(e.target.value)}>
                    <option value="all">Nivel</option>
                    <option value="INFO">INFO</option>
                    <option value="WARN">WARN</option>
                    <option value="ERROR">ERROR</option>
                </select>
            </div>
            <div style={{ fontSize: "11px", maxHeight: "260px", overflow: "auto", background: "#0f1722", padding: "6px", borderRadius: "6px" }}>
                {filtered.length === 0 && <div style={{ color: "#8aa0ba" }}>Sin eventos</div>}
                {filtered.map((log, idx) => {
                    const level = (log.level || "INFO").toUpperCase();
                    const color = level === "ERROR" ? "#ef4444" : level === "WARN" ? "#fbbf24" : "#22c55e";
                    return (
                        <div key={idx} style={{ borderBottom: "1px solid #1f2d3d", padding: "4px 0" }}>
                            <div style={{ color }}>{level}</div>
                            <div>{log.type || "event"} Â· {log.module || log.data?.module || "n/a"}</div>
                            <div style={{ color: "#9fb4cc" }}>{log.timestamp}</div>
                        </div>
                    );
                })}
            </div>
        </div>
    );
}
